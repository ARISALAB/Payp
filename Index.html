<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Καλώς Ήρθατε - Πληρωμή PayPal</title>
    <style>
        /* Στυλ */
        body { font-family: Arial, sans-serif; color: #333; margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; background-color: #f9f9f9; min-height: 100vh; }
        .container { max-width: 800px; width: 95%; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); background-color: white; margin: 20px 0; border-radius: 8px; text-align: center; }
        h1 { background-color: #0056b3; color: #fff; padding: 20px; margin: 0; border-radius: 8px; text-align: center; box-sizing: border-box; }
        h2 { color: #0056b3; margin-top: 20px; }
        .paypal-button { text-align: center; margin-top: 30px; }
        .google-button, .email-signup-button { background-color: #4285F4; color: white; border: none; padding: 10px 20px; font-size: 16px; border-radius: 4px; cursor: pointer; }
        .google-button:hover, .email-signup-button:hover { background-color: #357ae8; }
        .form-container { display: flex; flex-direction: column; gap: 15px; }
        .form-container input { padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
    <script src="https://www.paypal.com/sdk/js?client-id=AbP8aGEBpUSbe7x2frrXYzb502UdR7uL3CjpNb-Sp6lk7hy0j9sYRAJORgfzT01owV39NlnKlycB1mcj"></script>
</head>
<body>
    <div class="container">
        <h1>Καλώς Ήρθατε στη Σελίδα Πληρωμής μας</h1>
        <section class="section"><h2>Τι Θα Συναντήσετε Εδώ</h2></section>
        
        <div id="userInfo" style="display: none;">
            <h2>Καλώς Ήρθες!</h2>
            <img id="userImage" style="border-radius: 50%; width: 100px; height: 100px;">
            <p id="userName"></p>
        </div>
        
        <button id="accessAppButton" style="display: none; background-color: #0056b3; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Μετάβαση στην Εφαρμογή</button>
        
        <button class="google-button" id="googleSignOut" style="display: none;">Αποσύνδεση</button>
        
        <div class="paypal-button" id="paypal-button-container-basic"></div>
        <div class="paypal-button" id="paypal-button-container-plus"></div>
        <div class="paypal-button" id="paypal-button-container-premium"></div>
        
        <div id="auth-section" style="margin-top: 20px;">
            <h2>Σύνδεση ή Εγγραφή</h2>
            <button class="google-button" id="googleSignIn">Σύνδεση με Google</button>
            
            <div id="signup-section" style="margin-top: 20px;">
                <h3>Ή Εγγραφείτε με Email</h3>
                <div class="form-container">
                    <input type="email" id="email" placeholder="Ηλεκτρονικό Ταχυδρομείο" required>
                    <input type="password" id="password" placeholder="Κωδικός Πρόσβασης" required>
                    <button class="email-signup-button" id="emailSignUp">Εγγραφή</button>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
    
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // Έλεγχος συνδρομής
    const checkSubscriptionStatus = async (user) => {
        if (user) {
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                const subscriptionLevel = userDoc.data().subscriptionLevel;
                if (subscriptionLevel) {
                    document.getElementById('accessAppButton').style.display = 'inline-block';
                    document.getElementById('paypal-button-container-basic').style.display = 'none';
                    document.getElementById('paypal-button-container-plus').style.display = 'none';
                    document.getElementById('paypal-button-container-premium').style.display = 'none';
                } else {
                    alert("Δεν έχετε ενεργή συνδρομή.");
                }
            }
        }
    };

    // Ρύθμιση PayPal κουμπιών
    function setupPaypalButton(level, amount) {
        paypal.Buttons({
            createOrder: (data, actions) => actions.order.create({ purchase_units: [{ amount: { value: amount } }] }),
            onApprove: (data, actions) => actions.order.capture().then(async () => {
                const user = auth.currentUser;
                if (user) {
                    await setDoc(doc(db, "users", user.uid), { subscriptionLevel: level }, { merge: true });
                    checkSubscriptionStatus(user);
                } else {
                    alert("Σφάλμα: Ο χρήστης δεν είναι συνδεδεμένος!");
                }
            })
        }).render(`#paypal-button-container-${level}`);
    }

    setupPaypalButton('basic', '5.00');
    setupPaypalButton('plus', '10.00');
    setupPaypalButton('premium', '15.00');

    // Σύνδεση Google
    document.getElementById('googleSignIn').addEventListener('click', () => {
        signInWithPopup(auth, provider)
            .then((result) => {
                const user = result.user;
                document.getElementById('userImage').src = user.photoURL;
                document.getElementById('userName').innerText = `Όνομα: ${user.displayName}`;
                document.getElementById('userInfo').style.display = 'block';
                checkSubscriptionStatus(user);
            }).catch((error) => console.error(error));
    });

    document.getElementById('googleSignOut').addEventListener('click', () => {
        auth.signOut().then(() => {
            document.getElementById('userInfo').style.display = 'none';
            document.getElementById('accessAppButton').style.display = 'none';
            document.getElementById('googleSignIn').style.display = 'inline-block';
        });
    });

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('googleSignOut').style.display = 'inline-block';
            checkSubscriptionStatus(user);
        } else {
            document.getElementById('googleSignIn').style.display = 'inline-block';
        }
    });
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Αρχική Σελίδα</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="./11.png" type="image/png">

    <!-- Firebase CDN Compatibility Mode -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AbP8aGEBpUSbe7x2frrXYzb502UdR7uL3CjpNb-Sp6lk7hy0j9sYRAJORgfzT01owV39NlnKlycB1mcj&currency=EUR"></script>

    <style>
        .plans-container {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        .plan {
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 30%;
            text-align: center;
            padding: 20px;
            position: relative;
            background-color: #f9f9f9;
        }
        .plan-header {
            color: #fff;
            padding: 10px;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
        }
        .basic { background-color: #4caf50; }
        .plus { background-color: #2196f3; }
        .premium { background-color: #ff9800; }
        .paypal-button { margin-top: 20px; }
    </style>
</head>
<body>

<div id="auth-container">
    <!-- Authentication Forms -->
</div>

<div id="user-info" style="display: none;">
    <h2>Καλωσήρθες, <span id="user-name"></span>!</h2>
    <img id="user-photo" src="" alt="Φωτογραφία Χρήστη" style="width: 100px; height: 100px; border-radius: 50%;"/>
    <button onclick="signOut()">Αποσύνδεση</button>
</div>

<!-- Πλάνα Πληρωμών -->
<div class="plans-container" id="plans-container">
    <div class="plan">
        <div class="plan-header basic">Βασικό</div>
        <p>Τιμή: €10</p>
        <div id="paypal-basic" class="paypal-button"></div>
    </div>
    <div class="plan">
        <div class="plan-header plus">Plus</div>
        <p>Τιμή: €20</p>
        <div id="paypal-plus" class="paypal-button"></div>
    </div>
    <div class="plan">
        <div class="plan-header premium">Premium</div>
        <p>Τιμή: €30</p>
        <div id="paypal-premium" class="paypal-button"></div>
    </div>
</div>

<script>
    // Ρύθμιση Firebase με Compatibility Mode
    const firebaseConfig = {
        apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
        authDomain: "speedy-bazaar-411110.firebaseapp.com",
        projectId: "speedy-bazaar-411110",
        storageBucket: "speedy-bazaar-411110.appspot.com",
        messagingSenderId: "752456596300",
        appId: "1:752456596300:web:f920df7be01ba63d66ede9",
        measurementId: "G-NGZHWDY6S5"
    };

    // Αρχικοποίηση Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    let currentUser = null;

    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('auth-container').style.display = 'none';
            document.getElementById('user-name').innerText = user.displayName || "Χρήστης";
            document.getElementById('user-photo').src = user.photoURL || "./default-avatar.png";
        } else {
            currentUser = null;
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('auth-container').style.display = 'block';
        }
    });

    function savePaymentToDatabase(plan, amount) {
        if (!currentUser) {
            console.error("Ο χρήστης δεν είναι συνδεδεμένος.");
            return;
        }
        const paymentRef = database.ref('payments/' + currentUser.uid);
        paymentRef.push({
            plan: plan,
            amount: amount,
            timestamp: new Date().toISOString()
        }).then(() => {
            alert("Η πληρωμή σας αποθηκεύτηκε επιτυχώς!");
        }).catch((error) => {
            console.error("Σφάλμα κατά την αποθήκευση πληρωμής:", error);
        });
    }

    function setupPayPalButton(containerId, plan, amount) {
        paypal.Buttons({
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: { value: amount.toString() }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('Η πληρωμή ολοκληρώθηκε από ' + details.payer.name.given_name);
                    savePaymentToDatabase(plan, amount);
                });
            },
            onError: function(err) {
                console.error("Σφάλμα PayPal:", err);
            }
        }).render('#' + containerId);
    }

    setupPayPalButton('paypal-basic', 'Βασικό', 10);
    setupPayPalButton('paypal-plus', 'Plus', 20);
    setupPayPalButton('paypal-premium', 'Premium', 30);

    function signOut() {
        auth.signOut()
            .then(() => {
                alert("Αποσυνδεθήκατε επιτυχώς.");
            })
            .catch((error) => {
                console.error("Σφάλμα κατά την αποσύνδεση:", error);
            });
    }
</script>

</body>
</html>

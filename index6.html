<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Συναλλαγές ανά Προμηθευτή</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="11.png" type="image/png">
    <style>
        .supplier-card {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .supplier-card h2 {
            margin-bottom: 10px;
        }
        .transaction-list {
            margin-top: 10px;
        }
        .transaction-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #ffffff;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <h1>Συναλλαγές ανά Προμηθευτή</h1>
    <div id="supplier-cards-container"></div>

    <footer>&copy; 2024 Καταγραφή Συναλλαγών</footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
            authDomain: "speedy-bazaar-411110.firebaseapp.com",
            databaseURL: "https://speedy-bazaar-411110-default-rtdb.firebaseio.com",
            projectId: "speedy-bazaar-411110",
            storageBucket: "speedy-bazaar-411110.appspot.com",
            messagingSenderId: "752456596300",
            appId: "1:752456596300:web:f920df7be01ba63d66ede9",
            measurementId: "G-NGZHWDY6S5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);
        const database = getDatabase(app);

        // Check User Authentication
        onAuthStateChanged(auth, user => {
            if (!user) {
                alert('Παρακαλώ συνδεθείτε για να συνεχίσετε.');
                window.location.href = 'index.html';
            }
        });

        // Fetch Transactions grouped by Supplier
        function loadTransactionsBySupplier() {
            const transactionsRef = ref(database, 'transactions');
            onValue(transactionsRef, snapshot => {
                const data = snapshot.val();
                if (data) {
                    const suppliers = {};
                    for (const [key, transaction] of Object.entries(data)) {
                        if (!suppliers[transaction.supplier]) {
                            suppliers[transaction.supplier] = [];
                        }
                        suppliers[transaction.supplier].push(transaction);
                    }
                    renderSupplierCards(suppliers);
                }
            });
        }

        // Render Supplier Cards
        function renderSupplierCards(suppliers) {
            const container = document.getElementById('supplier-cards-container');
            container.innerHTML = '';

            for (const supplier in suppliers) {
                const supplierCard = document.createElement('div');
                supplierCard.className = 'supplier-card';
                supplierCard.innerHTML = `<h2>Προμηθευτής: ${supplier}</h2>`;
                
                const transactionList = document.createElement('div');
                transactionList.className = 'transaction-list';

                suppliers[supplier].forEach(transaction => {
                    const transactionItem = document.createElement('div');
                    transactionItem.className = 'transaction-item';
                    transactionItem.innerHTML = `
                        <p><strong>Αριθμός Τιμολογίου:</strong> ${transaction.invoiceNumber}</p>
                        <p><strong>Περιγραφή:</strong> ${transaction.description}</p>
                        <p><strong>Ποσό:</strong> ${transaction.amount} €</p>
                    `;
                    transactionList.appendChild(transactionItem);
                });

                supplierCard.appendChild(transactionList);
                container.appendChild(supplierCard);
            }
        }

        // Load transactions on page load
        loadTransactionsBySupplier();
    </script>
</body>
</html>

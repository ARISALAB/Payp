<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="11.png" type="image/png">
    <title>Συναλλαγές Προμηθευτών</title>
</head>
<body>
    <h1>Συναλλαγές Προμηθευτών</h1>
    <ul class="supplier-list" id="supplier-list"></ul>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
            authDomain: "speedy-bazaar-411110.firebaseapp.com",
            databaseURL: "https://speedy-bazaar-411110-default-rtdb.firebaseio.com",
            projectId: "speedy-bazaar-411110",
            storageBucket: "speedy-bazaar-411110.appspot.com",
            messagingSenderId: "752456596300",
            appId: "1:752456596300:web:f920df7be01ba63d66ede9",
            measurementId: "G-NGZHWDY6S5"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const supplierList = document.getElementById('supplier-list');

        function fetchTransactions() {
            const transactionsRef = ref(database, 'transactions');
            onValue(transactionsRef, (snapshot) => {
                const transactionsByDate = snapshot.val();
                if (!transactionsByDate) {
                    supplierList.innerHTML = '<li>Δεν υπάρχουν δεδομένα</li>';
                    return;
                }

                const supplierData = {};

                // Διασχίζουμε τα δεδομένα και τα οργανώνουμε ανά προμηθευτή
                Object.entries(transactionsByDate).forEach(([date, transactions]) => {
                    Object.entries(transactions).forEach(([id, transaction]) => {
                        const supplier = transaction.supplier;
                        if (!supplierData[supplier]) {
                            supplierData[supplier] = [];
                        }
                        supplierData[supplier].push({ date, ...transaction });
                    });
                });

                renderSupplierList(supplierData);
            });
        }

        function renderSupplierList(suppliers) {
            supplierList.innerHTML = '';
            Object.entries(suppliers).forEach(([supplier, transactions]) => {
                const listItem = document.createElement('li');
                const totalAmount = transactions.reduce((sum, transaction) => sum + parseFloat(transaction.amount), 0);

                listItem.innerHTML = `
                    <strong>${supplier}</strong><br>
                    Συνολικό Ποσό Συναλλαγών: ${totalAmount.toFixed(2)} €
                `;

                supplierList.appendChild(listItem);
            });
        }

        // Φόρτωση συναλλαγών από Firebase
        fetchTransactions();
    </script>
</body>
</html>

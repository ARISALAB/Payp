<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css"> <!-- Σύνδεσμος στο αρχείο CSS -->
    <link rel="icon" href="11.png" type="image/png">

    <title>Εβδομαδιαία Αναφορά Πληρωμών</title>
   
</head>
<body>

    <nav>
        <img src="11.png" alt="Logo" class="logo">
        <button class="menu-toggle">
            &#9776;<br>Menu
        </button>
        <div class="menu-items">
            <a href="index.html">Αρχική Σελίδα</a>
    
            <div class="dropdown">
                <a href="#">Συναλλαγές &#9662;</a>
                <div class="dropdown-content">
                    <a href="index1.html">Καταγραφή Εξόδων</a>
                    <a href="index4.html">Τιμολόγια Επί Πιστώσει</a>
                    <a href="index5.html">Πληρωμές Τράπεζας</a>
                </div>
            </div>
    
            <a href="index3.html">Καταγραφή Εσόδων</a>
            <a href="index2.html">Καρτέλες Προμηθευτών</a>
    
            <div class="dropdown">
                <a href="#">Αναφορές &#9662;</a>
                <div class="dropdown-content">
                    <a href="index7.html">Ημερήσια Αναφορά</a>
                    <a href="index6.html">Εβδομαδιαία Αναφορά</a>
                    <a href="index8.html">Μηνιαία Αναφορά</a>
                    <a href="index9.html">Ετήσια Αναφορά</a>
                </div>
            </div>
    
            <div class="dropdown">
                <a href="#">Προσωπικό &#9662;</a>
                <div class="dropdown-content">
                    <a href="employee-management.html">Καταγραφή Προσωπικού</a>
                    <a href="salary.html">Καταγραφή Μισθοδοσίας</a>
                    <a href="weekly-salary.html">Εβδομαδιαία Μισθοδοσία </a>
                    <a href="salary-report.html">Αναφορά Μισθοδοσίας</a>
                    

                </div>
            </div>
        </div>
    </nav>
    

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <a href="index.html">Αρχική Σελίδα</a>
            
            <div class="dropdown">
                <a href="#">Συναλλαγές</a>
                <div class="dropdown-content">
                    <a href="index1.html">Καταγραφή Εξόδων</a>
                    <a href="index4.html">Τιμολόγια Επί Πιστώσει</a>
                    <a href="index5.html">Πληρωμές Τράπεζας</a>
                </div>
            </div>
            
            <a href="index3.html">Καταγραφή Εσόδων</a>
            <a href="index2.html">Καρτέλες Προμηθευτών</a>
            
            <div class="dropdown">
                <a href="#">Αναφορές</a>
                <div class="dropdown-content">
                    <a href="index7.html">Ημερήσια Αναφορά</a>
                    <a href="index6.html">Εβδομαδιαία Αναφορά</a>
                    <a href="index8.html">Μηνιαία Αναφορά</a>
                    <a href="index9.html">Ετήσια Αναφορά</a>
                </div>
            </div>
            
            <!-- Νέα ενότητα για Προσωπικό -->
            <div class="dropdown">
                <a href="#">Προσωπικό &#9662;</a>
                <div class="dropdown-content">
                    <a href="employee-management.html">Καταγραφή Προσωπικού</a>
                    <a href="salary.html">Καταγραφή Μισθοδοσίας</a>
                    <a href="weekly-salary.html">Εβδομαδιαία Μισθοδοσία</a>
                    <a href="salary-report.html">Αναφορά Μισθοδοσίας</a>
                </div>
            </div>
            
        </div>
    </div>

    <h1>Εβδομαδιαία Αναφορά Πληρωμών</h1>
    <form id="week-form">
        <label for="start-date">Επιλέξτε Εβδομάδα (Ημερομηνία έναρξης)</label>
        <input type="date" id="start-date" required>
        <input type="submit" value="Προβολή Αναφοράς">
    </form>

    <table id="weekly-report">
        <thead>
            <tr>
                <th>Ημερομηνία</th>
                <th>Ταμείο (€)</th>
                <th>Έσοδα από Κάρτα (€)</th>
                <th>Έσοδα από Μετρητά (€)</th> <!-- Νέα Στήλη -->
                <th>Πληρωμές (€)</th>
                <th>Υπόλοιπο Μετρητών (€)</th> <!-- Νέα Στήλη -->
                <th>Τιμολόγια Επί Πιστώσει (€)</th>
                <th>Καταθέσεις (€)</th>
            </tr>
        </thead>
        
        
        <tbody>
            <!-- Rows will be dynamically added here -->
        </tbody>
    </table>

    <p id="total-cash-week">Ταμείο Εβδομάδας: 0.00 €</p>
    <p id="total-card-income">Τραπεζικά Έσοδα: 0.00 €</p>
    <p id="total-cash-balance">Μετρητά: 0.00 €</p>
    <p id="total-credit-invoices">Εκκρεμότητες: 0.00 €</p>
    
    
    <footer>&copy; 2024 Εβδομαδιαία Αναφορά Πληρωμών</footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const weekForm = document.getElementById('week-form');
            const startDateInput = document.getElementById('start-date');
            const weeklyReportTableBody = document.querySelector('#weekly-report tbody');
            const totalWeeklyAmountDisplay = document.getElementById('total-weekly-amount');

            // Data directories
            const paymentDir = 'payments';
            const revenueDir = 'revenueData';
            const creditInvoicesDir = 'credit-invoices';
            const depositDir = 'bank-payments';

            // Load stored data
            let payments = JSON.parse(localStorage.getItem(paymentDir)) || {};
            let revenueData = JSON.parse(localStorage.getItem(revenueDir)) || {};
            let creditInvoices = JSON.parse(localStorage.getItem(creditInvoicesDir)) || {};
            let deposits = JSON.parse(localStorage.getItem(depositDir)) || {};

            function getWeekRange(startDate) {
                const start = new Date(startDate);
                const end = new Date(start);
                end.setDate(start.getDate() + 6);
                return { start, end };
            }

            function formatDateString(date) {
                return date.toISOString().split('T')[0];
            }

            function renderWeeklyReport(weekData) {
    weeklyReportTableBody.innerHTML = '';

    let totalCashIncome = 0;
    let totalCardIncome = 0;
    let totalCashIncomeFromCash = 0;
    let totalPayments = 0;
    let totalCashBalance = 0;
    let totalCreditInvoices = 0;
    let totalDeposits = 0;

    weekData.forEach(data => {
        const cashIncome = data.cashIncome;
        const cardIncome = data.cardIncome;
        const payments = data.payments;

        const cashIncomeFromCash = cashIncome - cardIncome; // Υπολογισμός Έσοδα από Μετρητά
        const cashBalance = cashIncome - cardIncome - payments; // Υπολογισμός Υπόλοιπο Μετρητών

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${data.date}</td>
            <td>${cashIncome.toFixed(2)}</td>
            <td>${cardIncome.toFixed(2)}</td>
            <td>${cashIncomeFromCash.toFixed(2)}</td> <!-- Νέα Στήλη -->
            <td>${payments.toFixed(2)}</td>
            <td>${cashBalance.toFixed(2)}</td> <!-- Νέα Στήλη -->
            <td>${data.creditInvoices.toFixed(2)}</td>
            <td>${data.deposits.toFixed(2)}</td>
        `;
        weeklyReportTableBody.appendChild(row);

        // Συγκέντρωση των συνολικών ποσών
        totalCashIncome += cashIncome;
        totalCardIncome += cardIncome;
        totalCashIncomeFromCash += cashIncomeFromCash;
        totalPayments += payments;
        totalCashBalance += cashBalance;
        totalCreditInvoices += data.creditInvoices;
        totalDeposits += data.deposits;
    });

    // Δημιουργία γραμμής συνολικών
    const totalRow = document.createElement('tr');
    totalRow.innerHTML = `
        <td><strong>Σύνολο:</strong></td>
        <td><strong>${totalCashIncome.toFixed(2)}</strong></td>
        <td><strong>${totalCardIncome.toFixed(2)}</strong></td>
        <td><strong>${totalCashIncomeFromCash.toFixed(2)}</strong></td>
        <td><strong>${totalPayments.toFixed(2)}</strong></td>
        <td><strong>${totalCashBalance.toFixed(2)}</strong></td>
        <td><strong>${totalCreditInvoices.toFixed(2)}</strong></td>
        <td><strong>${totalDeposits.toFixed(2)}</strong></td>
    `;
    weeklyReportTableBody.appendChild(totalRow);

    // Ενημέρωση των συνολικών ποσών
    document.getElementById('total-cash-week').textContent = `Ταμείο Εβδομάδας: ${totalCashIncome.toFixed(2)} €`;
    document.getElementById('total-card-income').textContent = `Τραπεζικά Έσοδα: ${totalCardIncome.toFixed(2)} €`;
    document.getElementById('total-cash-balance').textContent = `Μετρητά: ${totalCashBalance.toFixed(2)} €`;
    document.getElementById('total-credit-invoices').textContent = `Εκκρεμότητες: ${totalCreditInvoices.toFixed(2)} €`;
}



            function loadWeeklyReport(startDate) {
                const { start, end } = getWeekRange(startDate);
                const weekData = [];

                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    const dateStr = formatDateString(d);

                    const cashIncome = revenueData[dateStr]?.cash || 0;
                    const cardIncome = revenueData[dateStr]?.card || 0;
                    const paymentsForDate = payments[dateStr] || [];
                    const creditInvoicesForDate = creditInvoices[dateStr] || [];
                    const depositsForDate = deposits[dateStr] || [];

                    const totalPayments = paymentsForDate.reduce((total, payment) => total + payment.amount, 0);
                    const totalCreditInvoices = creditInvoicesForDate.reduce((total, invoice) => total + invoice.amount, 0);
                    const totalDeposits = depositsForDate.reduce((total, deposit) => total + deposit.amount, 0);

                    weekData.push({
                        date: dateStr,
                        cashIncome,
                        cardIncome,
                        payments: totalPayments,
                        creditInvoices: totalCreditInvoices,
                        deposits: totalDeposits
                    });
                }

                renderWeeklyReport(weekData);
            }

            weekForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const startDate = startDateInput.value;
                loadWeeklyReport(startDate);
            });
        });
    </script>
    <script>
        document.querySelector('.menu-toggle').addEventListener('click', function() {
            document.getElementById('menuModal').style.display = 'flex';
        });
        
        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('menuModal').style.display = 'none';
        });
        
        window.onclick = function(event) {
            if (event.target == document.getElementById('menuModal')) {
                document.getElementById('menuModal').style.display = 'none';
            }
        }
        
        // Κώδικας για την απόκρυψη του toggle menu όταν μεγαλώνει η οθόνη
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('menuModal').style.display = 'none';
            }
        });
        
        </script>
        
        
</body>
</html>

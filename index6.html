<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Καρτέλες Προμηθευτών</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="11.png" type="image/png">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .supplier-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px auto;
            padding: 20px;
            width: 80%;
            background-color: #f8f9fa;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .supplier-card h2 {
            margin-bottom: 15px;
            color: #343a40;
        }

        .transaction-item {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-item strong {
            display: block;
        }

        #total-per-supplier {
            font-weight: bold;
            color: #2ecc71;
        }
    </style>
</head>
<body>
    <nav>
        <!-- Μπορείτε να αντιγράψετε το υπάρχον μενού -->
    </nav>

    <h1>Καρτέλες Προμηθευτών</h1>
    <div id="supplier-cards-container"></div>

    <footer>&copy; 2024 Καταγραφή Συναλλαγών</footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
            authDomain: "speedy-bazaar-411110.firebaseapp.com",
            databaseURL: "https://speedy-bazaar-411110-default-rtdb.firebaseio.com",
            projectId: "speedy-bazaar-411110",
            storageBucket: "speedy-bazaar-411110.appspot.com",
            messagingSenderId: "752456596300",
            appId: "1:752456596300:web:f920df7be01ba63d66ede9",
            measurementId: "G-NGZHWDY6S5"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const supplierCardsContainer = document.getElementById('supplier-cards-container');

        // Φόρτωση δεδομένων συναλλαγών
        function loadSupplierTransactions() {
            const transactionsRef = ref(database, 'transactions');
            onValue(transactionsRef, snapshot => {
                const transactionsData = snapshot.val();
                const groupedBySupplier = groupTransactionsBySupplier(transactionsData);
                renderSupplierCards(groupedBySupplier);
            });
        }

        // Ομαδοποίηση συναλλαγών ανά προμηθευτή
        function groupTransactionsBySupplier(transactionsData) {
            const grouped = {};

            for (const date in transactionsData) {
                const transactionsOnDate = transactionsData[date];
                for (const key in transactionsOnDate) {
                    const transaction = transactionsOnDate[key];
                    const supplier = transaction.supplier;

                    if (!grouped[supplier]) {
                        grouped[supplier] = [];
                    }

                    grouped[supplier].push({
                        ...transaction,
                        date
                    });
                }
            }

            return grouped;
        }

        // Δημιουργία καρτελών για προμηθευτές
        function renderSupplierCards(groupedTransactions) {
            supplierCardsContainer.innerHTML = '';

            for (const supplier in groupedTransactions) {
                const transactions = groupedTransactions[supplier];
                const supplierCard = document.createElement('div');
                supplierCard.classList.add('supplier-card');

                const totalAmount = transactions.reduce((sum, t) => sum + parseFloat(t.amount), 0);

                supplierCard.innerHTML = `
                    <h2>Προμηθευτής: ${supplier}</h2>
                    <div id="transactions-${supplier}">
                        ${transactions.map(t => `
                            <div class="transaction-item">
                                <strong>Ημερομηνία:</strong> ${t.date}
                                <strong>Τιμολόγιο:</strong> ${t.invoiceNumber}
                                <strong>Περιγραφή:</strong> ${t.description}
                                <strong>Ποσό:</strong> ${t.amount} €
                            </div>
                        `).join('')}
                    </div>
                    <p id="total-per-supplier">Συνολικό Ποσό: ${totalAmount.toFixed(2)} €</p>
                `;

                supplierCardsContainer.appendChild(supplierCard);
            }
        }

        // Φόρτωση αρχικών δεδομένων
        loadSupplierTransactions();
    </script>
</body>
</html>

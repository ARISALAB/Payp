<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Καταγραφή Εξόδων</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="11.png" type="image/png">



</head>
<body>
    <nav>
        <img src="11.png" alt="Logo" class="logo">
        <button class="menu-toggle">&#9776;<br>Menu</button>
        <div class="menu-items">
            <a href="index.html">Αρχική Σελίδα</a>
            <a href="index1.html">Καταγραφή Εξόδων</a>
            <a href="index3.html">Καταγραφή Εσόδων</a>
            <a href="index2.html">Καρτέλες Προμηθευτών</a>
        </div>
    </nav>

    <h1>Καταγραφή Εξόδων</h1>
    <form id="transaction-form">
        <label for="transaction-date">Ημερομηνία</label>
        <input type="date" id="transaction-date" required>

        <label for="supplier">Προμηθευτής</label>
        <input type="text" id="supplier" list="suppliers-list" required>
        <datalist id="suppliers-list"></datalist>

        <label for="invoice-number">Αριθμός Τιμολογίου</label>
        <input type="text" id="invoice-number" required>

        <label for="description">Περιγραφή</label>
        <input type="text" id="description" required>

        <label for="amount">Ποσό (€)</label>
        <input type="number" id="amount" step="0.01" required>

        <input type="submit" value="Προσθήκη Συναλλαγής">
    </form>

    <ul id="transaction-list"></ul>
    <p id="total-amount">Συνολικό Ποσό: 0.00 €</p>

    <footer>&copy; 2024 Καταγραφή Συναλλαγών</footer>

  <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
            authDomain: "speedy-bazaar-411110.firebaseapp.com",
            projectId: "speedy-bazaar-411110",
            storageBucket: "speedy-bazaar-411110.appspot.com",
            messagingSenderId: "752456596300",
            appId: "1:752456596300:web:f920df7be01ba63d66ede9",
            measurementId: "G-NGZHWDY6S5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

  // Check User Authentication
  onAuthStateChanged(auth, user => {
    if (!user) {
      alert('Παρακαλώ συνδεθείτε για να συνεχίσετε.');
      window.location.href = 'index.html';
    }
  });



        // DOM Elements
        const transactionForm = document.getElementById('transaction-form');
        const transactionDate = document.getElementById('transaction-date');
        const supplierInput = document.getElementById('supplier');
        const invoiceNumberInput = document.getElementById('invoice-number');
        const descriptionInput = document.getElementById('description');
        const amountInput = document.getElementById('amount');
        const transactionList = document.getElementById('transaction-list');
        const totalAmountDisplay = document.getElementById('total-amount');

        // Check User Authentication
        auth.onAuthStateChanged(user => {
            if (!user) {
                alert('Παρακαλώ συνδεθείτε για να συνεχίσετε.');
                window.location.href = 'login.html';
            }
        });

// Fetch Transactions from Firebase
function loadTransactions(date) {
    const transactionsRef = ref(database, `transactions/${date}`);
    onValue(transactionsRef, snapshot => {
        const data = snapshot.val();
        renderTransactionList(data || {}, date);
    });
}

        // Render Transactions
        function renderTransactionList(transactions, date) {
            transactionList.innerHTML = '';
            let totalAmount = 0;

            for (const [key, transaction] of Object.entries(transactions)) {
                const transactionItem = document.createElement('li');
                transactionItem.innerHTML = `
                    <div><strong>Προμηθευτής:</strong> ${transaction.supplier}</div>
                    <div><strong>Τιμολόγιο:</strong> ${transaction.invoiceNumber}</div>
                    <div><strong>Περιγραφή:</strong> ${transaction.description}</div>
                    <div><strong>Ποσό:</strong> ${transaction.amount} €</div>
                    <button class="delete-btn" data-key="${key}">Διαγραφή</button>
                `;
                transactionItem.querySelector('.delete-btn').addEventListener('click', () => deleteTransaction(date, key));
                transactionList.appendChild(transactionItem);
                totalAmount += parseFloat(transaction.amount);
            }

            totalAmountDisplay.textContent = `Συνολικό Ποσό: ${totalAmount.toFixed(2)} €`;
        }

// Add Transaction
transactionForm.addEventListener('submit', e => {
    e.preventDefault();

    const date = transactionDate.value;
    const supplier = supplierInput.value.trim();
    const invoiceNumber = invoiceNumberInput.value.trim();
    const description = descriptionInput.value.trim();
    const amount = parseFloat(amountInput.value);

    if (!date || !supplier || !invoiceNumber || !description || isNaN(amount)) {
        alert('Παρακαλώ συμπληρώστε όλα τα πεδία.');
        return;
    }

    const newTransaction = { supplier, invoiceNumber, description, amount };
    const transactionsRef = ref(database, `transactions/${date}`);
    push(transactionsRef, newTransaction);
    transactionForm.reset();
    transactionDate.value = date;
});

// Delete Transaction
function deleteTransaction(date, key) {
    const transactionRef = ref(database, `transactions/${date}/${key}`);
    remove(transactionRef);
}

// Load Initial Data
transactionDate.addEventListener('change', e => loadTransactions(e.target.value));
transactionDate.value = new Date().toISOString().split('T')[0];
loadTransactions(transactionDate.value);
    </script>
</body>
</html>

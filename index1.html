<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Καταγραφή Εξόδων</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="11.png" type="image/png">
    <STYLE>
    /* Κεντρική διάταξη για τις συναλλαγές */
#transaction-list {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
}

/* Καρτέλες Συναλλαγών */
#transaction-list li {
    background-color: #f8f9fa;
    padding: 20px;
    width: 80%;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
}

/* Κάθετη γραμμή στην αρχή κάθε καρτέλας */
#transaction-list li::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background-color: #28a745; /* Σκούρο πράσινο χρώμα */
}

/* Στυλ για τα κουμπιά */
button {
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    margin-top: 10px;
    cursor: pointer;
}

/* Κουμπί Διαγραφής */
button.delete-btn {
    background-color: #dc3545; /* Κόκκινο */
    color: white;
}

/* Κουμπί Επεξεργασίας */
button.edit-btn {
    background-color: #fd7e14; /* Πορτοκαλί */
    color: white;
}

/* Κεντρική εμφάνιση του συνολικού ποσού */
#total-amount {
    text-align: center;
    font-size: 1.5rem;
    margin-top: 20px;
    font-weight: bold;
}

/* Ενίσχυση του κεντρικού πλαισίου της σελίδας */
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    background-color: #e9ecef;
}

footer {
    text-align: center;
    padding: 20px;
    background-color: #343a40;
    color: white;
    width: 100%;
    position: fixed;
    bottom: 0;
}

    </STYLE>
</head>
<body>
    <nav>
        <img src="11.png" alt="Logo" class="logo">
        <button class="menu-toggle">&#9776;<br>Menu</button>
        <div class="menu-items">
            <a href="index.html">Αρχική Σελίδα</a>
            <a href="index1.html">Καταγραφή Εξόδων</a>
            <a href="index3.html">Καταγραφή Εσόδων</a>
            <a href="index2.html">Καρτέλες Προμηθευτών</a>
        </div>
    </nav>

    <h1>Καταγραφή Εξόδων</h1>
    <form id="transaction-form">
        <label for="transaction-date">Ημερομηνία</label>
        <input type="date" id="transaction-date" required>

        <label for="supplier">Προμηθευτής</label>
        <input type="text" id="supplier" list="suppliers-list" required>
        <datalist id="suppliers-list"></datalist>

        <label for="invoice-number">Αριθμός Τιμολογίου</label>
        <input type="text" id="invoice-number" required>

        <label for="description">Περιγραφή</label>
        <input type="text" id="description" required>

        <label for="amount">Ποσό (€)</label>
        <input type="number" id="amount" step="0.01" required>

        <input type="submit" value="Προσθήκη Συναλλαγής">
    </form>

    <ul id="transaction-list"></ul>
    <p id="total-amount">Συνολικό Ποσό: 0.00 €</p>

    <footer>&copy; 2024 Καταγραφή Συναλλαγών</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, getDocs, collection } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
  import { getDatabase, ref, onValue, push, remove, update, set } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
    authDomain: "speedy-bazaar-411110.firebaseapp.com",
    databaseURL: "https://speedy-bazaar-411110-default-rtdb.firebaseio.com",
    projectId: "speedy-bazaar-411110",
    storageBucket: "speedy-bazaar-411110.appspot.com",
    messagingSenderId: "752456596300",
    appId: "1:752456596300:web:f920df7be01ba63d66ede9",
    measurementId: "G-NGZHWDY6S5"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const database = getDatabase(app);

  onAuthStateChanged(auth, user => {
      if (!user) {
          alert('Παρακαλώ συνδεθείτε για να συνεχίσετε.');
          window.location.href = 'index.html';
      }
  });

  const transactionForm = document.getElementById('transaction-form');
  const transactionDate = document.getElementById('transaction-date');
  const supplierInput = document.getElementById('supplier');
  const invoiceNumberInput = document.getElementById('invoice-number');
  const descriptionInput = document.getElementById('description');
  const amountInput = document.getElementById('amount');
  const transactionList = document.getElementById('transaction-list');
  const totalAmountDisplay = document.getElementById('total-amount');

  function loadSuppliers() {
    const suppliersRef = ref(database, 'suppliers');
    onValue(suppliersRef, snapshot => {
        const data = snapshot.val();
        const suppliersList = document.getElementById('suppliers-list');
        suppliersList.innerHTML = '';
        for (const supplierName in data) {
            const option = document.createElement('option');
            option.value = supplierName;
            suppliersList.appendChild(option);
        }
    });
  }

  function loadTransactions(date) {
      const transactionsRef = ref(database, `transactions/${date}`);
      onValue(transactionsRef, snapshot => {
          const data = snapshot.val();
          renderTransactionList(data || {}, date);
      });
  }

  function renderTransactionList(transactions, date) {
      transactionList.innerHTML = '';
      let totalAmount = 0;

      for (const [key, transaction] of Object.entries(transactions)) {
          const transactionItem = document.createElement('li');
          transactionItem.innerHTML = `
              <div><strong>Προμηθευτής:</strong> ${transaction.supplier}</div>
              <div><strong>Τιμολόγιο:</strong> ${transaction.invoiceNumber}</div>
              <div><strong>Περιγραφή:</strong> ${transaction.description}</div>
              <div><strong>Ποσό:</strong> ${transaction.amount} €</div>
              <button class="edit-btn" data-key="${key}">Επεξεργασία</button>
              <button class="delete-btn" data-key="${key}">Διαγραφή</button>
          `;
          transactionItem.querySelector('.delete-btn').addEventListener('click', () => deleteTransaction(date, key));
          transactionItem.querySelector('.edit-btn').addEventListener('click', () => editTransaction(date, key, transaction));
          transactionList.appendChild(transactionItem);
          totalAmount += parseFloat(transaction.amount);
      }

      totalAmountDisplay.textContent = `Συνολικό Ποσό: ${totalAmount.toFixed(2)} €`;
  }

  function deleteTransaction(date, key) {
      const transactionRef = ref(database, `transactions/${date}/${key}`);
      remove(transactionRef);
  }

  function editTransaction(date, key, transaction) {
      transactionDate.value = date;
      supplierInput.value = transaction.supplier;
      invoiceNumberInput.value = transaction.invoiceNumber;
      descriptionInput.value = transaction.description;
      amountInput.value = transaction.amount;
  }

  transactionForm.addEventListener('submit', (event) => {
      event.preventDefault();

      const transaction = {
          supplier: supplierInput.value,
          invoiceNumber: invoiceNumberInput.value,
          description: descriptionInput.value,
          amount: amountInput.value,
      };

      const date = transactionDate.value;
      const transactionRef = ref(database, `transactions/${date}`);
      const newTransactionRef = push(transactionRef);
      set(newTransactionRef, transaction);

      transactionForm.reset();
  });

  loadSuppliers();
</script>
</body>
</html>

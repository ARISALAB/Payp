<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ημερήσια Αναφορά</title>
    <style>
        /* Το ίδιο CSS με πριν */
    </style>
</head>
<body style="display: none;">
    <h1>Ημερήσια Αναφορά</h1>
    <form id="revenue-form">
        <label for="revenue-date">Επιλέξτε Ημερομηνία:</label>
        <input type="date" id="revenue-date" required>
        <input type="number" id="cash-revenue" placeholder="Έσοδα Μετρητά" required>
        <input type="number" id="card-revenue" placeholder="Έσοδα Κάρτες" required>
        <button type="submit">Καταχώρηση</button>
    </form>

    <table id="report-table">
        <thead>
            <tr>
                <th>Κατηγορία</th>
                <th>Ποσό (€)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Ταμείο Ημέρας</td>
                <td id="cash-revenue-display">0.00</td>
            </tr>
            <tr>
                <td>Έσοδα από Κάρτες</td>
                <td id="card-revenue-display">0.00</td>
            </tr>
            <tr>
                <td>Συνολικό Ποσό Συναλλαγών</td>
                <td id="transactions-total-display">0.00</td>
            </tr>
            <tr>
                <td>Υπόλοιπο Μετρητών</td>
                <td id="cash-balance-display">0.00</td>
            </tr>
        </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        const firebaseConfig = { /* Οι ρυθμίσεις σας */ };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);
        const database = getDatabase(app);

        async function saveRevenueToFirestore(date, cash, card) {
            const user = auth.currentUser;
            if (!user) throw new Error("Ο χρήστης δεν είναι συνδεδεμένος!");
            const revenueDoc = doc(db, "revenues", user.uid);
            const currentData = (await getDoc(revenueDoc)).data() || {};
            currentData[date] = { cash, card };
            await setDoc(revenueDoc, currentData);
        }

        async function updateSummary() {
            const revenueDate = document.getElementById("revenue-date").value;
            if (!revenueDate) return;

            const user = auth.currentUser;
            const revenueDoc = doc(db, "revenues", user.uid);
            const revenueData = (await getDoc(revenueDoc)).data() || {};
            const revenue = revenueData[revenueDate] || { cash: 0, card: 0 };

            document.getElementById("cash-revenue-display").textContent = revenue.cash.toFixed(2);
            document.getElementById("card-revenue-display").textContent = revenue.card.toFixed(2);
        }

        document.getElementById("revenue-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const date = document.getElementById("revenue-date").value;
            const cash = parseFloat(document.getElementById("cash-revenue").value);
            const card = parseFloat(document.getElementById("card-revenue").value);
            await saveRevenueToFirestore(date, cash, card);
            await updateSummary();
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.body.style.display = "block";
            } else {
                document.body.style.display = "none";
                alert("Παρακαλώ συνδεθείτε!");
            }
        });
    </script>
</body>
</html>

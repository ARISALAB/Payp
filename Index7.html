<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ημερήσια Αναφορά</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            text-align: center;
            padding: 10px;
        }
        th {
            background-color: #f0f0f0;
        }
        .summary {
            margin-top: 20px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>Ημερήσια Αναφορά Εσόδων</h1>
    <div id="daily-summary" class="summary">
        <p><strong>Ταμείο Ημέρας:</strong> <span id="total-cash">0.00 €</span></p>
        <p><strong>Συνολικά Έσοδα από Κάρτες:</strong> <span id="total-cards">0.00 €</span></p>
        <p><strong>Συνολικό Υπόλοιπο:</strong> <span id="total-balance">0.00 €</span></p>
    </div>
    <table>
        <thead>
            <tr>
                <th>Ημερομηνία</th>
                <th>Ταμείο Ημέρας (€)</th>
                <th>Έσοδα από Κάρτες (€)</th>
                <th>Σύνολο (€)</th>
            </tr>
        </thead>
        <tbody id="revenue-table">
            <!-- Τα δεδομένα θα εισαχθούν δυναμικά -->
        </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAlFCOK49HAzisru-KTTF0ZqP_mtmEyt6Y",
            authDomain: "speedy-bazaar-411110.firebaseapp.com",
            databaseURL: "https://speedy-bazaar-411110-default-rtdb.firebaseio.com",
            projectId: "speedy-bazaar-411110",
            storageBucket: "speedy-bazaar-411110.appspot.com",
            messagingSenderId: "752456596300",
            appId: "1:752456596300:web:f920df7be01ba63d66ede9",
            measurementId: "G-NGZHWDY6S5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

        async function loadDailyReport() {
            const user = auth.currentUser;
            if (!user) {
                alert("Παρακαλώ συνδεθείτε!");
                window.location.href = "index.html";
                return;
            }

            const revenueDoc = doc(db, "revenues", user.uid);
            const revenueSnapshot = await getDoc(revenueDoc);

            if (!revenueSnapshot.exists()) {
                alert("Δεν βρέθηκαν δεδομένα!");
                return;
            }

            const revenues = revenueSnapshot.data();
            const tableBody = document.getElementById("revenue-table");
            const totalCashEl = document.getElementById("total-cash");
            const totalCardsEl = document.getElementById("total-cards");
            const totalBalanceEl = document.getElementById("total-balance");

            let totalCash = 0;
            let totalCards = 0;

            tableBody.innerHTML = ""; // Καθαρισμός του πίνακα

            Object.keys(revenues).sort().forEach(date => {
                const { cash, card } = revenues[date];
                const total = cash + card;

                totalCash += cash;
                totalCards += card;

                const row = `
                    <tr>
                        <td>${date}</td>
                        <td>${cash.toFixed(2)} €</td>
                        <td>${card.toFixed(2)} €</td>
                        <td>${total.toFixed(2)} €</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });

            totalCashEl.textContent = `${totalCash.toFixed(2)} €`;
            totalCardsEl.textContent = `${totalCards.toFixed(2)} €`;
            totalBalanceEl.textContent = `${(totalCash + totalCards).toFixed(2)} €`;
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                loadDailyReport();
            } else {
                alert("Παρακαλώ συνδεθείτε!");
                window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>
